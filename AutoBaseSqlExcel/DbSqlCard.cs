using System;
using System.Data;
using System.Data.SqlClient;
using System.Windows.Forms;
using System.Drawing;
using System.Collections;

namespace AutoBaseSql
{
	/// <summary>
	/// Summary description for DbSqlCard.
	/// </summary>
	public class DbSqlCard
	{
		// Работа с базой данных
		public static SqlCommand		select_card;
		public static SqlCommand		select_card_today_time;
		public static SqlCommand		select_card_goin_time;
		public static SqlCommand		select_card_goin_time_pause;
		public static SqlCommand		select_card_workshop;
		public static SqlCommand		select_card_closed;
		public static SqlCommand		select_card_closed_number;
		public static SqlCommand		select_card_closed_number_avtovaz;
		public static SqlCommand		select_card_closed_number_workshop;
		public static SqlCommand		select_card_closed_number_workshop_auto;
		public static SqlCommand		select_card_open_number_workshop;
		public static SqlCommand		select_card_open_number_auto;
		public static SqlCommand		select_card_closed_number_workshop_nal;
		public static SqlCommand		select_card_notclosed_date_number_workshop;
		public static SqlCommand		select_card_open_interval_number_workshop;
		public static SqlCommand		select_warrant_number;	// Выборка заказ-наряда по номеру
		public static SqlCommand		select_number;			// Выборка карточки по номеру
		public static SqlCommand		select_number_year;		// Выборка карточки по номеру и дате
		public static SqlCommand		select_auto;			// Выборка карточек по коду автомобиля
		public static SqlCommand		select_partner;			// Выборка карточек по коду владельца и представителя
		public static SqlCommand		select_card_detail;		// Выборка карточек в которых содержится ссылка на деталь
		public static SqlCommand		select_card_returned;	// Выборка возвратов в определенном интервале
		public static SqlCommand		find;
		public static SqlCommand		find_number_year;		// Поиск по номеру и году
		public static SqlCommand		find_rate;				// Поиск для списка оценки
		public static SqlCommand		set_status_control;
		public static SqlCommand		set_master;				// Установка мастера-контролера по заказ-наряду
		public static SqlCommand		set_discount;			// Установка скидки по заказ-наряду
        public static SqlCommand        set_discount_parts;		// Установка скидки по заказ-наряду на детали
		public static SqlCommand		set_print;				// Отметка о печати карточки
		public static SqlCommand		set_supervisor_guaranty;// Отметка об одобрении гарантии
		public static SqlCommand		set_supervisor_payment;	// Отметка об одобрении оплаты
		public static SqlCommand		set_supervisor_whole;	// Полное одобрение оплаты
		public static SqlCommand		set_licence_vehicle;	// Установка свидетельства о регистрации
		public static SqlCommand		set_licence_plate;		// Номерного знака
		public static SqlCommand		set_return_flag;		// Установка признака возвратной карточки
		public static SqlCommand		set_service_manager;		// Установка сервис-консультанта
		public static SqlCommand		set_service_manager_ever;	// Установка сервис-консультанта всегда (без проверки предыдущего)
		public static SqlCommand		set_creditcard_flag;		// Установка признака Оплаты по кредитной карте

		public static SqlCommand		auxiliary_auto_set_null;	// Обнуление автомобиля в карточке
		public static SqlCommand		auxiliary_partner_replace;	// Замена владельца автомобиля в карточке
		public static SqlCommand		auxiliary_auto_replace;		// Замена автомобиля в карточке
		public static SqlCommand		auxiliary_card_insert;		// Служебное создание карточки
		public static SqlCommand		auxiliary_card_set_date;	// Установка даты и времени создания карточки
		public static SqlCommand		auxiliary_warrant_set;		// Установка новых данных заказ-наряда
		public static SqlCommand		auxiliary_warrant_open;		// Открытие заказ-наряда
		public static SqlCommand		auxiliary_run_set;			// Установка новых данных по пробегу
		public static SqlCommand		auxiliary_warrant_close;	// Закрытие заказ-наряда
		public static SqlCommand		auxiliary_warrant_close_set;// Установка даты закрытия заказ-наряда

		public static SqlCommand		select_card_auto_run;		// Выборка карточки с максимльным пробегом по автомобилю

		// Самые новые
		public static SqlCommand card_set_agreedPickupTime; // Установка согласованного времени выдачи
		public static SqlCommand card_write;

		private static SqlCommand _spUpdate;
		private static SqlCommand _spFind;
		private static SqlCommand _spInsert;

		public DbSqlCard()
		{
		}

		public static void SetSqlCommandValues(DtCard srcDtCard, SqlCommand srcSqlCommand)
        {
			DbSql.SetParameterValue("number", srcDtCard.Number, srcSqlCommand);
			DbSql.SetParameterValue("year", srcDtCard.Year, srcSqlCommand);
			DbSql.SetParameterValue("date", srcDtCard.Date, srcSqlCommand);
			DbSql.SetParameterValue("codeAuto", srcDtCard.CodeAuto, srcSqlCommand);
			DbSql.SetParameterValue("codePartner", srcDtCard.CodeOwner, srcSqlCommand);
			DbSql.SetParameterValue("codeRepresent", srcDtCard.CodeRepresentative, srcSqlCommand);
			DbSql.SetParameterValue("representDocument", srcDtCard.RepresentativeDocs, srcSqlCommand);
			DbSql.SetParameterValue("codeAutoType", srcDtCard.CodeAutoType, srcSqlCommand);
			DbSql.SetParameterValue("run", srcDtCard.CardRun, srcSqlCommand);
			DbSql.SetParameterValue("return", srcDtCard.Returned, srcSqlCommand);
			DbSql.SetParameterValue("discount_works", srcDtCard.Discount, srcSqlCommand);
			DbSql.SetParameterValue("discount_details", srcDtCard.DiscountDetail, srcSqlCommand);
			DbSql.SetParameterValue("service_manager_code", srcDtCard.ServiceManagerCode, srcSqlCommand);
			DbSql.SetParameterValue("cashless", srcDtCard.Cashless, srcSqlCommand);
			DbSql.SetParameterValue("inner", srcDtCard.Inner, srcSqlCommand);
			DbSql.SetParameterValue("credit_card", srcDtCard.CreditCard, srcSqlCommand);
			DbSql.SetParameterValue("comment", srcDtCard.Comment, srcSqlCommand);
			DbSql.SetParameterValue("codeWorkshop", srcDtCard.CodeWorkshop, srcSqlCommand);
			DbSql.SetParameterValue("licensePlateNumber", srcDtCard.LicensePlate.Number, srcSqlCommand);
			DbSql.SetParameterValue("licensePlateRegion", srcDtCard.LicensePlate.Region, srcSqlCommand);
			DbSql.SetParameterValue("agreedPickupTime", srcDtCard.AgreedPickUpTime, srcSqlCommand);
			DbSql.SetParameterValue("state", srcDtCard.State, srcSqlCommand);
		}
		public static object ReadCard(SqlDataReader reader)
		{
			DtCard dtCard = new DtCard()
			{
				CardCode = DbSql.GetValueLong(reader, "КОД_КАРТОЧКА"),
				Number = DbSql.GetValueLong(reader, "НОМЕР_КАРТОЧКА"),
				Year = DbSql.GetValueInt(reader, "ГОД_КАРТОЧКА"),
				Date = DbSql.GetValueDate(reader, "ДАТА"),
				CodeAuto = DbSql.GetValueLong(reader, "КАРТОЧКА_ССЫЛКА_КОД_АВТОМОБИЛЬ"),
				CodeOwner = DbSql.GetValueLong(reader, "КАРТОЧКА_ССЫЛКА_КОД_КОНТРАГЕНТ"),
				CodeRepresentative = DbSql.GetValueLong(reader, "ССЫЛКА_КОД_ПРЕДСТАВИТЕЛЬ"),
				RepresentativeDocs = DbSql.GetValueString(reader, "ДОКУМЕНТ_ПРЕДСТАВИТЕЛЬ"),
				CodeAutoType = DbSql.GetValueLong(reader, "КАРТОЧКА_ССЫЛКА_КОД_АВТОМОБИЛЬ_ТИП"),
				CardRun = DbSql.GetValueInt(reader, "ПРОБЕГ"),
				Returned = DbSql.GetValueBool(reader, "ВОЗВРАТ"),
				Discount = DbSql.GetValueFloat(reader, "СКИДКА_РАБОТА_КАРТОЧКА"),
				DiscountDetail = DbSql.GetValueFloat(reader, "СКИДКА_ДЕТАЛЬ_КАРТОЧКА"),
				ServiceManagerCode = DbSql.GetValueLong(reader, "СЕРВИС_КОНСУЛЬТАНТ"),
				Cashless = DbSql.GetValueBool(reader, "БЕЗНАЛ"),
				Inner = DbSql.GetValueBool(reader, "ВНУТРЕННИЙ_КАРТОЧКА"),
				CreditCard = DbSql.GetValueBool(reader, "КРЕДИТНАЯ_КАРТА_КАРТОЧКА"),
				Comment = DbSql.GetValueString(reader, "ПРИМЕЧАНИЕ_КАРТОЧКА"),
				CodeWorkshop = DbSql.GetValueLong(reader, "ССЫЛКА_КОД_ЦЕХ"),
				AgreedPickUpTime = DbSql.GetValueDate(reader, "ВРЕМЯ_ВЫДАЧИ_СОГЛАСОВАННОЕ"),
				State = (DtCard.CardState)DbSql.GetValueShort(reader, "СТАТУС_КАРТОЧКА"),
				StateControl = DbSql.GetValueShort(reader, "СТАТУС_КОНТРОЛЬ_КАРТОЧКА"),
				WarrantNumber = DbSql.GetValueLong(reader, "НОМЕР_НАРЯД"),
				MasterCode = DbSql.GetValueLong(reader, "МАСТЕР_КОНТРОЛЕР_КАРТОЧКА"),
				IsChg = false, // Отмечаем, что это не измененный элемент
				IsNew = false // Отмечаем, что это не новый
			};	
			dtCard.LicensePlate.Number = DbSql.GetValueString(reader, "НОМЕР_ЗНАК_НОМЕР");
			dtCard.LicensePlate.Region = DbSql.GetValueString(reader, "НОМЕР_ЗНАК_РЕГИОН");
			return dtCard;
		}
		public static bool Insert(DtCard srcCard)
        {
			if (srcCard == null) return false;
			if (!srcCard.IsNew) return false;
			SetSqlCommandValues(srcCard, _spInsert);
			if (DbSql.ExecuteCommandError(_spInsert) == false) return Error.ErroMessageFalse("Ошибка при записи в БД");
			srcCard.Number = (long)DbSql.GetParameterValue("number", DbSql.SQL_PARAMETER_TYPE.LONG, _spInsert);
			srcCard.Year = (int)DbSql.GetParameterValue("year", DbSql.SQL_PARAMETER_TYPE.INT, _spInsert);
			srcCard.Date = (DateTime)DbSql.GetParameterValue("date", DbSql.SQL_PARAMETER_TYPE.DATETIME, _spInsert);
			return true;
        }
		public static bool Update(DtCard srcCard)
		{
			if (srcCard == null) return false;
			if (!srcCard.IsChg) return true;
			SetSqlCommandValues(srcCard, _spUpdate);
			return DbSql.ExecuteCommandError(_spUpdate);
		}
		public static DtCard Find(DtCard srcCard)
		{
			if (srcCard == null) return null;
			SetSqlCommandValues(srcCard, _spFind);
			return (DtCard) DbSql.Find(_spFind, new DbSql.DelegateReadDt(ReadCard));
		}
		public static bool Write(DtCard srcCard)
		{
			// Если небыло изменений, к базе данных не обращаемся
			if (srcCard.IsNew)
				return Insert(srcCard);
			if (!srcCard.IsChg) return true;
			return Update(srcCard);
		}

		public static void Init(SqlConnection connection)
		{
			card_write = new SqlCommand("КАРТОЧКА_ЗАПИСАТЬ", connection);
			card_write.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(card_write);

			_spUpdate = new SqlCommand("КАРТОЧКА_UPDATE", connection);
			DbSql.AddParameter("number", DbSql.SQL_PARAMETER_TYPE.LONG, _spUpdate);
			DbSql.AddParameter("year", DbSql.SQL_PARAMETER_TYPE.INT, _spUpdate);
			DbSql.AddParameter("date", DbSql.SQL_PARAMETER_TYPE.DATETIME, _spUpdate);
			DbSql.AddParameter("codeAutoType", DbSql.SQL_PARAMETER_TYPE.LONG, _spUpdate);
			DbSql.AddParameter("codePartner", DbSql.SQL_PARAMETER_TYPE.LONG, _spUpdate);
			DbSql.AddParameter("codeRepresent", DbSql.SQL_PARAMETER_TYPE.LONG, _spUpdate);
			DbSql.AddParameter("representDocument", DbSql.SQL_PARAMETER_TYPE.STRING, _spUpdate);
			DbSql.AddParameter("codeAuto", DbSql.SQL_PARAMETER_TYPE.LONG, _spUpdate);
			DbSql.AddParameter("run", DbSql.SQL_PARAMETER_TYPE.INT, _spUpdate);
			DbSql.AddParameter("return", DbSql.SQL_PARAMETER_TYPE.BOOL, _spUpdate);
			DbSql.AddParameter("discount_works", DbSql.SQL_PARAMETER_TYPE.FLOAT, _spUpdate);
			DbSql.AddParameter("discount_details", DbSql.SQL_PARAMETER_TYPE.FLOAT, _spUpdate);
			DbSql.AddParameter("service_manager_code", DbSql.SQL_PARAMETER_TYPE.LONG, _spUpdate);
			DbSql.AddParameter("cashless", DbSql.SQL_PARAMETER_TYPE.BOOL, _spUpdate);
			DbSql.AddParameter("inner", DbSql.SQL_PARAMETER_TYPE.BOOL, _spUpdate);
			DbSql.AddParameter("credit_card", DbSql.SQL_PARAMETER_TYPE.BOOL, _spUpdate);
			DbSql.AddParameter("comment", DbSql.SQL_PARAMETER_TYPE.STRING, _spUpdate);
			DbSql.AddParameter("codeWorkshop", DbSql.SQL_PARAMETER_TYPE.LONG, _spUpdate);
			DbSql.AddParameter("licensePlateNumber", DbSql.SQL_PARAMETER_TYPE.STRING, _spUpdate);
			DbSql.AddParameter("licensePlateRegion", DbSql.SQL_PARAMETER_TYPE.STRING, _spUpdate);
			DbSql.AddParameter("agreedPickupTime", DbSql.SQL_PARAMETER_TYPE.DATETIME, _spUpdate);
			DbSql.AddParameter("state", DbSql.SQL_PARAMETER_TYPE.SHORT, _spUpdate);
			DbSql.SetStoredProcedure(_spUpdate);
			DbSql.SetReturnError(_spUpdate);

			_spInsert = new SqlCommand("КАРТОЧКА_INSERT", connection);
			DbSql.AddParameter("number", DbSql.SQL_PARAMETER_TYPE.LONG, _spInsert);
			DbSql.AddParameter("year", DbSql.SQL_PARAMETER_TYPE.INT, _spInsert);
			DbSql.AddParameter("date", DbSql.SQL_PARAMETER_TYPE.DATETIME, _spInsert);
			DbSql.AddParameter("codeAutoType", DbSql.SQL_PARAMETER_TYPE.LONG, _spInsert);
			DbSql.AddParameter("codePartner", DbSql.SQL_PARAMETER_TYPE.LONG, _spInsert);
			DbSql.AddParameter("codeRepresent", DbSql.SQL_PARAMETER_TYPE.LONG, _spInsert);
			DbSql.AddParameter("representDocument", DbSql.SQL_PARAMETER_TYPE.STRING, _spInsert);
			DbSql.AddParameter("codeAuto", DbSql.SQL_PARAMETER_TYPE.LONG, _spInsert);
			DbSql.AddParameter("run", DbSql.SQL_PARAMETER_TYPE.INT, _spInsert);
			DbSql.AddParameter("return", DbSql.SQL_PARAMETER_TYPE.BOOL, _spInsert);
			DbSql.AddParameter("discount_works", DbSql.SQL_PARAMETER_TYPE.FLOAT, _spInsert);
			DbSql.AddParameter("discount_details", DbSql.SQL_PARAMETER_TYPE.FLOAT, _spInsert);
			DbSql.AddParameter("service_manager_code", DbSql.SQL_PARAMETER_TYPE.LONG, _spInsert);
			DbSql.AddParameter("cashless", DbSql.SQL_PARAMETER_TYPE.BOOL, _spInsert);
			DbSql.AddParameter("inner", DbSql.SQL_PARAMETER_TYPE.BOOL, _spInsert);
			DbSql.AddParameter("credit_card", DbSql.SQL_PARAMETER_TYPE.BOOL, _spInsert);
			DbSql.AddParameter("comment", DbSql.SQL_PARAMETER_TYPE.STRING, _spInsert);
			DbSql.AddParameter("codeWorkshop", DbSql.SQL_PARAMETER_TYPE.LONG, _spInsert);
			DbSql.AddParameter("licensePlateNumber", DbSql.SQL_PARAMETER_TYPE.STRING, _spInsert);
			DbSql.AddParameter("licensePlateRegion", DbSql.SQL_PARAMETER_TYPE.STRING, _spInsert);
			DbSql.AddParameter("agreedPickupTime", DbSql.SQL_PARAMETER_TYPE.DATETIME, _spInsert);
			DbSql.AddParameter("state", DbSql.SQL_PARAMETER_TYPE.SHORT, _spInsert);
			DbSql.SetStoredProcedure(_spInsert);
			DbSql.SetReturnError(_spInsert);
			DbSql.SetParameterOutput("number", _spInsert);
			DbSql.SetParameterOutput("year", _spInsert);
			DbSql.SetParameterOutput("date", _spInsert);

			_spFind = new SqlCommand("КАРТОЧКА_FIND", connection);
			DbSql.AddParameter("number", DbSql.SQL_PARAMETER_TYPE.LONG, _spFind);
			DbSql.AddParameter("year", DbSql.SQL_PARAMETER_TYPE.INT, _spFind);
			DbSql.SetStoredProcedure(_spFind);

			// Самые новые
			card_set_agreedPickupTime = new SqlCommand("КАРТОЧКА_ИЗМЕНЕНИЕ_ВРЕМЯ_ВЫДАЧИ_СОГЛАСОВАННОЕ", connection);
			card_set_agreedPickupTime.Parameters.Add("@number", SqlDbType.BigInt);
			card_set_agreedPickupTime.Parameters.Add("@year", SqlDbType.Int);
			card_set_agreedPickupTime.Parameters.Add("@date", SqlDbType.DateTime);
			card_set_agreedPickupTime.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(card_set_agreedPickupTime);


			select_card = new SqlCommand("КАРТОЧКА_ВЫБОРКА", connection);
			select_card.Parameters.Add("@date_start", SqlDbType.DateTime);
			select_card.Parameters.Add("@date_end", SqlDbType.DateTime);
			select_card.Parameters.Add("@no_date", SqlDbType.Bit);
			select_card.Parameters.Add("@owner_mask", SqlDbType.VarChar);
			select_card.Parameters.Add("@vin_mask", SqlDbType.VarChar);
			select_card.Parameters.Add("@sign_mask", SqlDbType.VarChar);
			select_card.Parameters.Add("@show_cancel", SqlDbType.Bit);
			select_card.CommandType = CommandType.StoredProcedure;

			select_card_today_time = new SqlCommand("КАРТОЧКА_ВЫБОРКА_СЕГОДНЯ_ВРЕМЯ", connection);
			select_card_today_time.Parameters.Add("@date", SqlDbType.DateTime);
			select_card_today_time.CommandType = CommandType.StoredProcedure;

			select_card_goin_time = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ЗАЕЗД_ВРЕМЯ", connection);
			select_card_goin_time.CommandType = CommandType.StoredProcedure;

			select_card_goin_time_pause = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ЗАЕЗД_ВРЕМЯ_ПАУЗА", connection);
			select_card_goin_time_pause.CommandType = CommandType.StoredProcedure;

			select_card_workshop = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ПОДРАЗДЕЛЕНИЕ", connection);
			select_card_workshop.Parameters.Add("@date_start", SqlDbType.DateTime);
			select_card_workshop.Parameters.Add("@date_end", SqlDbType.DateTime);
			select_card_workshop.Parameters.Add("@no_date", SqlDbType.Bit);
			select_card_workshop.Parameters.Add("@owner_mask", SqlDbType.VarChar);
			select_card_workshop.Parameters.Add("@vin_mask", SqlDbType.VarChar);
			select_card_workshop.Parameters.Add("@sign_mask", SqlDbType.VarChar);
			select_card_workshop.Parameters.Add("@show_cancel", SqlDbType.Bit);
			select_card_workshop.Parameters.Add("@code_workshop", SqlDbType.BigInt);
			select_card_workshop.CommandType = CommandType.StoredProcedure;

			select_card_closed = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ЗАКРЫТЫЕ", connection);
			select_card_closed.Parameters.Add("@date", SqlDbType.DateTime);
			select_card_closed.CommandType = CommandType.StoredProcedure;
			select_card_closed.CommandTimeout = 360;

			select_card_closed_number = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ЗАКРЫТЫЕ_НОМЕРА", connection);
			select_card_closed_number.Parameters.Add("@date_start", SqlDbType.DateTime);
			select_card_closed_number.Parameters.Add("@date_end", SqlDbType.DateTime);
			select_card_closed_number.CommandType = CommandType.StoredProcedure;
			select_card_closed_number.CommandTimeout = 360;

			select_card_closed_number_avtovaz = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ЗАКРЫТЫЕ_НОМЕРА_АВТОВАЗ", connection);
			select_card_closed_number_avtovaz.Parameters.Add("@date_start", SqlDbType.DateTime);
			select_card_closed_number_avtovaz.Parameters.Add("@date_end", SqlDbType.DateTime);
			select_card_closed_number_avtovaz.CommandType = CommandType.StoredProcedure;
			select_card_closed_number_avtovaz.CommandTimeout = 360;


			select_card_closed_number_workshop = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ЗАКРЫТЫЕ_НОМЕРА_ПОДРАЗДЕЛЕНИЕ", connection);
			select_card_closed_number_workshop.Parameters.Add("@date_start", SqlDbType.DateTime);
			select_card_closed_number_workshop.Parameters.Add("@date_end", SqlDbType.DateTime);
			select_card_closed_number_workshop.Parameters.Add("@workshop", SqlDbType.BigInt);
			select_card_closed_number_workshop.CommandType = CommandType.StoredProcedure;
			select_card_closed_number_workshop.CommandTimeout = 360;

			select_card_closed_number_workshop_auto = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ЗАКРЫТЫЕ_НОМЕРА_ПОДРАЗДЕЛЕНИЕ_АВТОМОБИЛЬ", connection);
			select_card_closed_number_workshop_auto.Parameters.Add("@date_start", SqlDbType.DateTime);
			select_card_closed_number_workshop_auto.Parameters.Add("@date_end", SqlDbType.DateTime);
			select_card_closed_number_workshop_auto.Parameters.Add("@workshop", SqlDbType.BigInt);
			select_card_closed_number_workshop_auto.Parameters.Add("@auto", SqlDbType.BigInt);
			select_card_closed_number_workshop_auto.CommandType = CommandType.StoredProcedure;
			select_card_closed_number_workshop_auto.CommandTimeout = 360;

			select_card_open_number_workshop = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ОТКРЫТЫЕ_НОМЕРА_ПОДРАЗДЕЛЕНИЕ", connection);
			select_card_open_number_workshop.Parameters.Add("@workshop", SqlDbType.BigInt);
			select_card_open_number_workshop.CommandType = CommandType.StoredProcedure;
			select_card_open_number_workshop.CommandTimeout = 360;

			select_card_open_number_auto = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ОТКРЫТЫЕ_НОМЕРА_АВТОМОБИЛЬ", connection);
			select_card_open_number_auto.Parameters.Add("@code_auto", SqlDbType.BigInt);
			select_card_open_number_auto.CommandType = CommandType.StoredProcedure;
			select_card_open_number_auto.CommandTimeout = 360;

			select_card_closed_number_workshop_nal = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ЗАКРЫТЫЕ_НОМЕРА_ПОДРАЗДЕЛЕНИЕ_НАЛ", connection);
			select_card_closed_number_workshop_nal.Parameters.Add("@date_start", SqlDbType.DateTime);
			select_card_closed_number_workshop_nal.Parameters.Add("@date_end", SqlDbType.DateTime);
			select_card_closed_number_workshop_nal.Parameters.Add("@workshop", SqlDbType.BigInt);
			select_card_closed_number_workshop_nal.CommandType = CommandType.StoredProcedure;
			select_card_closed_number_workshop_nal.CommandTimeout = 360;

			select_card_notclosed_date_number_workshop = new SqlCommand("КАРТОЧКА_ВЫБОРКА_НЕЗАКРЫТЫЕ_НАДАТУ_НОМЕРА_ПОДРАЗДЕЛЕНИЕ", connection);
			select_card_notclosed_date_number_workshop.Parameters.Add("@workshop", SqlDbType.BigInt);
			select_card_notclosed_date_number_workshop.Parameters.Add("@date", SqlDbType.DateTime);
			select_card_notclosed_date_number_workshop.CommandType = CommandType.StoredProcedure;
			select_card_notclosed_date_number_workshop.CommandTimeout = 360;

			select_card_open_interval_number_workshop = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ОТКРЫТЫЕ_ВИНТЕРВАЛЕ_НОМЕРА_ПОДРАЗДЕЛЕНИЕ", connection);
			select_card_open_interval_number_workshop.Parameters.Add("@workshop", SqlDbType.BigInt);
			select_card_open_interval_number_workshop.Parameters.Add("@date_start", SqlDbType.DateTime);
			select_card_open_interval_number_workshop.Parameters.Add("@date_end", SqlDbType.DateTime);
			select_card_open_interval_number_workshop.CommandType = CommandType.StoredProcedure;
			select_card_open_interval_number_workshop.CommandTimeout = 360;

			select_card_auto_run = new SqlCommand("КАРТОЧКА_ВЫБОРКА_АВТОМОБИЛЬ_ПРОБЕГ", connection);
			select_card_auto_run.Parameters.Add("@code_auto", SqlDbType.BigInt);
			select_card_auto_run.CommandType = CommandType.StoredProcedure;

			select_auto = new SqlCommand("КАРТОЧКА_ВЫБОРКА_АВТОМОБИЛЬ", connection);
			select_auto.Parameters.Add("@code_auto", SqlDbType.BigInt);
			select_auto.CommandType = CommandType.StoredProcedure;

			select_partner = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ВЛАДЕЛЕЦ", connection);
			select_partner.Parameters.Add("@code_partner", SqlDbType.BigInt);
			select_partner.CommandType = CommandType.StoredProcedure;

			select_card_detail = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ДЕТАЛЬ", connection);
			select_card_detail.Parameters.Add("@code_storage", SqlDbType.BigInt);
			select_card_detail.CommandType = CommandType.StoredProcedure;

			select_card_returned = new SqlCommand("КАРТОЧКА_ВЫБОРКА_ВОЗВРАТ", connection);
			select_card_returned.Parameters.Add("@date_start", SqlDbType.DateTime);
			select_card_returned.Parameters.Add("@date_end", SqlDbType.DateTime);
			select_card_returned.CommandType = CommandType.StoredProcedure;


			find = new SqlCommand("КАРТОЧКА_ПОИСК", connection);
			find.Parameters.Add("@code", SqlDbType.BigInt);
			find.CommandType = CommandType.StoredProcedure;

			find_number_year = new SqlCommand("КАРТОЧКА_ПОИСК_НОМЕР_ГОД", connection);
			find_number_year.Parameters.Add("@number", SqlDbType.BigInt);
			find_number_year.Parameters.Add("@year", SqlDbType.Int);
			find_number_year.CommandType = CommandType.StoredProcedure;

			find_rate = new SqlCommand("КАРТОЧКА_ПОИСК_ДЛЯ_ОЦЕНКИ", connection);
			find_rate.Parameters.Add("@number", SqlDbType.BigInt);
			find_rate.Parameters.Add("@year", SqlDbType.Int);
			find_rate.CommandType = CommandType.StoredProcedure;

			select_number_year = new SqlCommand("КАРТОЧКА_ВЫБОРКА_НОМЕР_ГОД", connection);
			select_number_year.Parameters.Add("@number", SqlDbType.BigInt);
			select_number_year.Parameters.Add("@year", SqlDbType.Int);
			select_number_year.CommandType = CommandType.StoredProcedure;

			select_warrant_number = new SqlCommand("КАРТОЧКА_ВЫБОРКА_НОМЕР_НАРЯД", connection);
			select_warrant_number.Parameters.Add("@warrant_number", SqlDbType.BigInt);
			select_warrant_number.CommandType = CommandType.StoredProcedure;

			select_number = new SqlCommand("КАРТОЧКА_ВЫБОРКА_НОМЕР", connection);
			select_number.Parameters.Add("@number", SqlDbType.BigInt);
			select_number.CommandType = CommandType.StoredProcedure;

			set_status_control = new SqlCommand("КАРТОЧКА_ИЗМЕНИТЬ_СТАТУС_КОНТРОЛЬ", connection);
			set_status_control.Parameters.Add("@code", SqlDbType.BigInt);
			set_status_control.Parameters.Add("@status_control", SqlDbType.SmallInt);
			set_status_control.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_status_control);

			set_master = new SqlCommand("КАРТОЧКА_ИЗМЕНИТЬ_МАСТЕР_КОНТРОЛЕР", connection);
			set_master.Parameters.Add("@card_number", SqlDbType.BigInt);
			set_master.Parameters.Add("@card_year", SqlDbType.Int);
			set_master.Parameters.Add("@card_code", SqlDbType.BigInt);
			set_master.Parameters.Add("@master_code", SqlDbType.BigInt);
			set_master.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_master);

			set_supervisor_guaranty = new SqlCommand("КАРТОЧКА_ОДОБРИТЬ_ГАРАНТИЮ", connection);
			set_supervisor_guaranty.Parameters.Add("@card_number", SqlDbType.BigInt);
			set_supervisor_guaranty.Parameters.Add("@card_year", SqlDbType.Int);
			set_supervisor_guaranty.Parameters.Add("@supervisor_guaranty", SqlDbType.BigInt);
			set_supervisor_guaranty.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_supervisor_guaranty);

			set_supervisor_payment = new SqlCommand("КАРТОЧКА_ОДОБРИТЬ_ОПЛАТУ", connection);
			set_supervisor_payment.Parameters.Add("@card_number", SqlDbType.BigInt);
			set_supervisor_payment.Parameters.Add("@card_year", SqlDbType.Int);
			set_supervisor_payment.Parameters.Add("@supervisor_payment", SqlDbType.BigInt);
			set_supervisor_payment.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_supervisor_payment);

			set_supervisor_whole = new SqlCommand("КАРТОЧКА_ОДОБРИТЬ_ПОЛНОСТЬЮ", connection);
			set_supervisor_whole.Parameters.Add("@card_number", SqlDbType.BigInt);
			set_supervisor_whole.Parameters.Add("@card_year", SqlDbType.Int);
			set_supervisor_whole.Parameters.Add("@supervisor_whole", SqlDbType.BigInt);
			set_supervisor_whole.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_supervisor_whole);

			set_discount = new SqlCommand("КАРТОЧКА_ИЗМЕНИТЬ_СКИДКА", connection);
			set_discount.Parameters.Add("@card_number", SqlDbType.BigInt);
			set_discount.Parameters.Add("@card_year", SqlDbType.Int);
			set_discount.Parameters.Add("@card_code", SqlDbType.BigInt);
			set_discount.Parameters.Add("@code_discount", SqlDbType.BigInt);
			set_discount.Parameters.Add("@discount", SqlDbType.Real);
			set_discount.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_discount);

            set_discount_parts = new SqlCommand("КАРТОЧКА_ИЗМЕНИТЬ_СКИДКА_ДЕТАЛЬ", connection);
            set_discount_parts.Parameters.Add("@card_number", SqlDbType.BigInt);
            set_discount_parts.Parameters.Add("@card_year", SqlDbType.Int);
            set_discount_parts.Parameters.Add("@discount", SqlDbType.Real);
            set_discount_parts.CommandType = CommandType.StoredProcedure;
            DbSql.SetReturnError(set_discount_parts);

			set_licence_vehicle = new SqlCommand("КАРТОЧКА_ОТМЕТКА_СВИДЕТЕЛЬСТВО_ТС", connection);
			set_licence_vehicle.Parameters.Add("@card_number", SqlDbType.BigInt);
			set_licence_vehicle.Parameters.Add("@card_year", SqlDbType.Int);
			set_licence_vehicle.Parameters.Add("@code_licence", SqlDbType.BigInt);
			set_licence_vehicle.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_licence_vehicle);

			set_licence_plate = new SqlCommand("КАРТОЧКА_ИЗМЕНЕНИЕ_НОМЕР_ЗНАК", connection);
			set_licence_plate.Parameters.Add("@card_number", SqlDbType.BigInt);
			set_licence_plate.Parameters.Add("@card_year", SqlDbType.Int);
			set_licence_plate.Parameters.Add("@licence_plate_number", SqlDbType.VarChar);
			set_licence_plate.Parameters.Add("@licence_plate_region", SqlDbType.VarChar);
			set_licence_plate.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_licence_plate);

			set_return_flag = new SqlCommand("КАРТОЧКА_ИЗМЕНЕНИЕ_ВОЗВРАТ", connection);
			set_return_flag.Parameters.Add("@card_number", SqlDbType.BigInt);
			set_return_flag.Parameters.Add("@card_year", SqlDbType.Int);
			set_return_flag.Parameters.Add("@returned", SqlDbType.Bit);
			set_return_flag.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_return_flag);

			set_print = new SqlCommand("КАРТОЧКА_ПЕЧАТЬ_ДОБАВИТЬ", connection);
			set_print.Parameters.Add("@card_number", SqlDbType.BigInt);
			set_print.Parameters.Add("@card_year", SqlDbType.Int);
			set_print.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_print);

			
			set_service_manager = new SqlCommand("КАРТОЧКА_УСТАНОВИТЬ_СЕРВИС_КОНСУЛЬТАНТ", connection);
			set_service_manager.Parameters.Add("@card_number", SqlDbType.BigInt);
			set_service_manager.Parameters.Add("@card_year", SqlDbType.Int);
			set_service_manager.Parameters.Add("@service_manager_code", SqlDbType.BigInt);
			set_service_manager.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_service_manager);

			set_service_manager_ever = new SqlCommand("КАРТОЧКА_УСТАНОВИТЬ_СЕРВИС_КОНСУЛЬТАНТ_ВСЕГДА", connection);
			set_service_manager_ever.Parameters.Add("@card_number", SqlDbType.BigInt);
			set_service_manager_ever.Parameters.Add("@card_year", SqlDbType.Int);
			set_service_manager_ever.Parameters.Add("@service_manager_code", SqlDbType.BigInt);
			set_service_manager_ever.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_service_manager_ever);

			set_creditcard_flag = new SqlCommand("КАРТОЧКА_ИЗМЕНЕНИЕ_КРЕДИТНАЯ_КАРТА", connection);
			set_creditcard_flag.Parameters.Add("@card_number", SqlDbType.BigInt);
			set_creditcard_flag.Parameters.Add("@card_year", SqlDbType.Int);
			set_creditcard_flag.Parameters.Add("@creditcard", SqlDbType.Bit);
			set_creditcard_flag.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(set_creditcard_flag);


			// Опасные служебные
			auxiliary_auto_set_null = new SqlCommand("КАРТОЧКА_ОБНУЛИТЬ_АВТОМОБИЛЬ_СЛУЖЕБНОЕ", connection);
			auxiliary_auto_set_null.Parameters.Add("@card_number", SqlDbType.BigInt);
			auxiliary_auto_set_null.Parameters.Add("@card_year", SqlDbType.Int);
			auxiliary_auto_set_null.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(auxiliary_auto_set_null);

			auxiliary_partner_replace = new SqlCommand("КАРТОЧКА_ЗАМЕНИТЬ_ВЛАДЕЛЕЦ_СЛУЖЕБНОЕ", connection);
			auxiliary_partner_replace.Parameters.Add("@card_number", SqlDbType.BigInt);
			auxiliary_partner_replace.Parameters.Add("@card_year", SqlDbType.Int);
			auxiliary_partner_replace.Parameters.Add("@code_partner", SqlDbType.BigInt);
			auxiliary_partner_replace.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(auxiliary_partner_replace);

			auxiliary_auto_replace = new SqlCommand("КАРТОЧКА_ЗАМЕНИТЬ_АВТОМОБИЛЬ_СЛУЖЕБНОЕ", connection);
			auxiliary_auto_replace.Parameters.Add("@card_number", SqlDbType.BigInt);
			auxiliary_auto_replace.Parameters.Add("@card_year", SqlDbType.Int);
			auxiliary_auto_replace.Parameters.Add("@code_auto", SqlDbType.BigInt);
			auxiliary_auto_replace.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(auxiliary_auto_replace);

			auxiliary_card_insert = new SqlCommand("КАРТОЧКА_ДОБАВЛЕНИЕ_СЛУЖЕБНОЕ", connection);
			auxiliary_card_insert.Parameters.Add("@number", SqlDbType.BigInt);
			auxiliary_card_insert.Parameters.Add("@date", SqlDbType.DateTime);
			auxiliary_card_insert.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(auxiliary_card_insert);

			auxiliary_card_set_date = new SqlCommand("КАРТОЧКА_ИЗМЕНЕНИЕ_ДАТА_СЛУЖЕБНОЕ", connection);
			auxiliary_card_set_date.Parameters.Add("@number", SqlDbType.BigInt);
			auxiliary_card_set_date.Parameters.Add("@year", SqlDbType.Int);
			auxiliary_card_set_date.Parameters.Add("@date", SqlDbType.DateTime);
			auxiliary_card_set_date.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(auxiliary_card_set_date);

			auxiliary_warrant_set = new SqlCommand("КАРТОЧКА_ИЗМЕНЕНИЕ_НАРЯД_СЛУЖЕБНОЕ", connection);
			auxiliary_warrant_set.Parameters.Add("@number", SqlDbType.BigInt);
			auxiliary_warrant_set.Parameters.Add("@year", SqlDbType.Int);
			auxiliary_warrant_set.Parameters.Add("@warrant_date", SqlDbType.DateTime);
			auxiliary_warrant_set.Parameters.Add("@warrant_number", SqlDbType.BigInt);
			auxiliary_warrant_set.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(auxiliary_warrant_set);

			auxiliary_warrant_open = new SqlCommand("КАРТОЧКА_ОТКРЫТИЕ_НАРЯД_СЛУЖЕБНОЕ", connection);
			auxiliary_warrant_open.Parameters.Add("@number", SqlDbType.BigInt);
			auxiliary_warrant_open.Parameters.Add("@year", SqlDbType.Int);
			auxiliary_warrant_open.Parameters.Add("@warrant_date", SqlDbType.DateTime);
			auxiliary_warrant_open.Parameters.Add("@warrant_number", SqlDbType.BigInt);
			auxiliary_warrant_open.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(auxiliary_warrant_open);

			auxiliary_run_set = new SqlCommand("КАРТОЧКА_ИЗМЕНЕНИЕ_ПРОБЕГ_СЛУЖЕБНОЕ", connection);
			auxiliary_run_set.Parameters.Add("@number", SqlDbType.BigInt);
			auxiliary_run_set.Parameters.Add("@year", SqlDbType.Int);
			auxiliary_run_set.Parameters.Add("@run", SqlDbType.Int);
			auxiliary_run_set.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(auxiliary_run_set);

			auxiliary_warrant_close = new SqlCommand("КАРТОЧКА_ЗАКРЫТИЕ_НАРЯД_СЛУЖЕБНОЕ", connection);
			auxiliary_warrant_close.Parameters.Add("@number", SqlDbType.BigInt);
			auxiliary_warrant_close.Parameters.Add("@year", SqlDbType.Int);
			auxiliary_warrant_close.Parameters.Add("@close_date", SqlDbType.DateTime);
			auxiliary_warrant_close.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(auxiliary_warrant_close);

			auxiliary_warrant_close_set = new SqlCommand("КАРТОЧКА_ИЗМЕНЕНИЕ_НАРЯД_ЗАКРЫТИЕ_СЛУЖЕБНОЕ", connection);
			auxiliary_warrant_close_set.Parameters.Add("@number", SqlDbType.BigInt);
			auxiliary_warrant_close_set.Parameters.Add("@year", SqlDbType.Int);
			auxiliary_warrant_close_set.Parameters.Add("@close_date", SqlDbType.DateTime);
			auxiliary_warrant_close_set.CommandType = CommandType.StoredProcedure;
			DbSql.SetReturnError(auxiliary_warrant_close_set);
		}

		public static void PrepareSelectCard(SearchCard search)
		{
			// Подготовка команды поиска по структуре поиска
			select_card.Parameters["@date_start"].Value = (DateTime)search.DateStart;
			select_card.Parameters["@date_end"].Value = (DateTime)search.DateEnd;
			select_card.Parameters["@no_date"].Value = (bool)search.NoDate;
			select_card.Parameters["@show_cancel"].Value = (bool)search.ShowCancel;
			select_card.Parameters["@owner_mask"].Value = (string)search.OwnerMask;
			select_card.Parameters["@vin_mask"].Value = (string)search.VinMask;
			select_card.Parameters["@sign_mask"].Value = (string)search.SignMask;

			select_card_workshop.Parameters["@date_start"].Value = (DateTime)search.DateStart;
			select_card_workshop.Parameters["@date_end"].Value = (DateTime)search.DateEnd;
			select_card_workshop.Parameters["@no_date"].Value = (bool)search.NoDate;
			select_card_workshop.Parameters["@show_cancel"].Value = (bool)search.ShowCancel;
			select_card_workshop.Parameters["@owner_mask"].Value = (string)search.OwnerMask;
			select_card_workshop.Parameters["@vin_mask"].Value = (string)search.VinMask;
			select_card_workshop.Parameters["@sign_mask"].Value = (string)search.SignMask;
			select_card_workshop.Parameters["@code_workshop"].Value = (long)search.Workshop;
		}

		public static void SelectCardClosed(ListView list, DateTime date)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_closed.Parameters["@date"].Value = (DateTime)date;
			DbSql.FillList(list, select_card_closed, new DbSql.DelegateMakeLVItem(DbSqlCard.MakeLV_List));
		}

		public static void SelectCardClosedNumber(ArrayList array, DateTime date_start, DateTime date_end)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_closed_number.Parameters["@date_start"].Value = (DateTime)date_start;
			select_card_closed_number.Parameters["@date_end"].Value = (DateTime)date_end;
			DbSql.FillArray(array, select_card_closed_number, new DbSql.DelegateMakeElement(DbSqlCard.MakeElement));
		}

		public static void SelectCardClosedNumberAvtovaz(ArrayList array, DateTime date_start, DateTime date_end)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_closed_number_avtovaz.Parameters["@date_start"].Value = (DateTime)date_start;
			select_card_closed_number_avtovaz.Parameters["@date_end"].Value = (DateTime)date_end;
			DbSql.FillArray(array, select_card_closed_number_avtovaz, new DbSql.DelegateMakeElement(DbSqlCard.MakeElement));
		}

		public static void SelectCardClosedNumberWorkshop(ArrayList array, DateTime date_start, DateTime date_end, long workshop)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_closed_number_workshop.Parameters["@date_start"].Value = (DateTime)date_start;
			select_card_closed_number_workshop.Parameters["@date_end"].Value = (DateTime)date_end;
			select_card_closed_number_workshop.Parameters["@workshop"].Value = (long)workshop;
			DbSql.FillArray(array, select_card_closed_number_workshop, new DbSql.DelegateMakeElement(DbSqlCard.MakeElement));
		}

		public static void SelectCardClosedNumberWorkshopAuto(ArrayList array, DateTime date_start, DateTime date_end, long workshop, long auto)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_closed_number_workshop_auto.Parameters["@date_start"].Value = (DateTime)date_start;
			select_card_closed_number_workshop_auto.Parameters["@date_end"].Value = (DateTime)date_end;
			select_card_closed_number_workshop_auto.Parameters["@workshop"].Value = (long)workshop;
			select_card_closed_number_workshop_auto.Parameters["@auto"].Value = (long)auto;
			DbSql.FillArray(array, select_card_closed_number_workshop_auto, new DbSql.DelegateMakeElement(DbSqlCard.MakeElement));
		}

		public static void SelectCardOpenNumberWorkshop(ArrayList array, long workshop)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_open_number_workshop.Parameters["@workshop"].Value = (long)workshop;
			DbSql.FillArray(array, select_card_open_number_workshop, new DbSql.DelegateMakeElement(DbSqlCard.MakeElement));
		}

		public static void SelectCardOpenNumberAuto(ArrayList array, long code_auto)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_open_number_auto.Parameters["@code_auto"].Value = (long)code_auto;
			DbSql.FillArray(array, select_card_open_number_auto, new DbSql.DelegateMakeElement(DbSqlCard.MakeElement));
		}

		public static void SelectCardClosedNumberWorkshopNal(ArrayList array, DateTime date_start, DateTime date_end, long workshop)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_closed_number_workshop_nal.Parameters["@date_start"].Value = (DateTime)date_start;
			select_card_closed_number_workshop_nal.Parameters["@date_end"].Value = (DateTime)date_end;
			select_card_closed_number_workshop_nal.Parameters["@workshop"].Value = (long)workshop;
			DbSql.FillArray(array, select_card_closed_number_workshop_nal, new DbSql.DelegateMakeElement(DbSqlCard.MakeElement));
		}

		public static void SelectCardNotClosedDateNumberWorkshop(ArrayList array, long workshop, DateTime date)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_notclosed_date_number_workshop.Parameters["@workshop"].Value	= (long)workshop;
			select_card_notclosed_date_number_workshop.Parameters["@date"].Value		= (DateTime)date;
			DbSql.FillArray(array, select_card_notclosed_date_number_workshop, new DbSql.DelegateMakeElement(DbSqlCard.MakeElement));
		}

		public static void SelectCardOpenIntervalNumberWorkshop(ArrayList array, long workshop, DateTime date_start, DateTime date_end)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_open_interval_number_workshop.Parameters["@workshop"].Value		= (long)workshop;
			select_card_open_interval_number_workshop.Parameters["@date_start"].Value	= (DateTime)date_start;
			select_card_open_interval_number_workshop.Parameters["@date_end"].Value		= (DateTime)date_end;
			DbSql.FillArray(array, select_card_open_interval_number_workshop, new DbSql.DelegateMakeElement(DbSqlCard.MakeElement));
		}


		public static void SelectWarrantNumber(ListView list, long warrant_number)
		{
			// Подготовка команды поиска по структуре поиска
			select_warrant_number.Parameters["@warrant_number"].Value = (long)warrant_number;
			DbSql.FillList(list, select_warrant_number, new DbSql.DelegateMakeLVItem(DbSqlCard.MakeLV_List));
		}

		public static void SelectWarrantNumber(ArrayList array, long warrant_number)
		{
			// Подготовка команды поиска по структуре поиска
			select_warrant_number.Parameters["@warrant_number"].Value = (long)warrant_number;
			DbSql.FillArray(array, select_warrant_number, new DbSql.DelegateMakeElement(DbSqlCard.MakeElement));
		}

		public static void SelectCardTodayTime(ArrayList array, DateTime today)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_today_time.Parameters["@date"].Value = (DateTime)today;
			DbSql.FillArray(array, select_card_today_time, new DbSql.DelegateMakeElement(DbSqlCard.MakeElementList2));
		}

		public static void SelectCardGoinTime(ArrayList array)
		{
			// Подготовка команды поиска по структуре поиска
			DbSql.FillArray(array, select_card_goin_time, new DbSql.DelegateMakeElement(DbSqlCard.MakeElementList2));
		}

		public static void SelectCardGoinTimePause(ArrayList array)
		{
			// Подготовка команды поиска по структуре поиска
			DbSql.FillArray(array, select_card_goin_time_pause, new DbSql.DelegateMakeElement(DbSqlCard.MakeElementList2));
		}

		public static void SelectNumber(ListView list, long number)
		{
			// Подготовка команды поиска по структуре поиска
			select_number.Parameters["@number"].Value = (long)number;
			DbSql.FillList(list, select_number, new DbSql.DelegateMakeLVItem(DbSqlCard.MakeLV_List));
		}

		public static void SelectAuto(ListView list, DtAuto auto)
		{
			// Подготовка команды поиска по структуре поиска
			select_auto.Parameters["@code_auto"].Value = (long)auto.GetData("КОД_АВТОМОБИЛЬ");
			DbSql.FillList(list, select_auto, new DbSql.DelegateMakeLVItem(DbSqlCard.MakeLV_List));
		}

		public static DtCard FindCardAutoRun(DtAuto auto)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_auto_run.Parameters["@code_auto"].Value = (long)auto.GetData("КОД_АВТОМОБИЛЬ");
			return (DtCard)DbSql.Find(select_card_auto_run, new DbSql.DelegateMakeElement(DbSqlCard.MakeElement));
		}

		public static void SelectAuto(ListView list, long code_auto)
		{
			// Подготовка команды поиска по структуре поиска
			select_auto.Parameters["@code_auto"].Value = (long)code_auto;
			DbSql.FillList(list, select_auto, new DbSql.DelegateMakeLVItem(DbSqlCard.MakeLV_List));
		}

		public static void SelectPartner(ListView list, long code_partner)
		{
			// Подготовка команды поиска по структуре поиска
			select_partner.Parameters["@code_partner"].Value = (long)code_partner;
			DbSql.FillList(list, select_partner, new DbSql.DelegateMakeLVItem(DbSqlCard.MakeLV_List));
		}

		public static void SelectCardDetail(ListView list, long code_storage)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_detail.Parameters["@code_storage"].Value = (long)code_storage;
			DbSql.FillList(list, select_card_detail, new DbSql.DelegateMakeLVItem(DbSqlCard.MakeLV_List));
		}

		public static void SelectInListCardReturned(ListView list, DateTime start, DateTime stop)
		{
			// Подготовка команды поиска по структуре поиска
			select_card_returned.Parameters["@date_start"].Value = start;
			select_card_returned.Parameters["@date_end"].Value = stop;
			DbSql.FillList(list, select_card_returned, new DbSql.DelegateMakeLVItem(DbSqlCard.MakeLV_List));
		}
		public static object MakeElement(SqlDataReader reader)
		{
			DtCard element = new DtCard();
			element.SetData("КОД_КАРТОЧКА", DbSql.GetValueLong(reader, "КОД_КАРТОЧКА"));
			element.SetData("НОМЕР_КАРТОЧКА", DbSql.GetValueLong(reader, "НОМЕР_КАРТОЧКА"));
			element.SetData("ГОД_КАРТОЧКА", DbSql.GetValueInt(reader, "ГОД_КАРТОЧКА"));
			element.SetData("ВЛАДЕЛЕЦ_КАРТОЧКА", DbSql.GetValueLong(reader, "ВЛАДЕЛЕЦ_КАРТОЧКА"));
			element.SetData("ВЛАДЕЛЕЦ_КАРТОЧКА", DbSql.GetValueLong(reader, "ВЛАДЕЛЕЦ_КАРТОЧКА"));
			element.SetData("ПРЕДСТАВИТЕЛЬ_КАРТОЧКА", DbSql.GetValueLong(reader, "ПРЕДСТАВИТЕЛЬ_КАРТОЧКА"));
			element.CodeAuto =  DbSql.GetValueLong(reader, "АВТОМОБИЛЬ_КАРТОЧКА");
			element.SetData("ДОКУМЕНТ_ПРЕДСТАВИТЕЛЬ_КАРТОЧКА", DbSql.GetValueString(reader, "ДОКУМЕНТ_ПРЕДСТАВИТЕЛЬ_КАРТОЧКА"));
			element.SetData("ПРОБЕГ_КАРТОЧКА", DbSql.GetValueInt(reader, "ПРОБЕГ_КАРТОЧКА"));
			element.SetData("СТАТУС_КАРТОЧКА", DbSql.GetValueShort(reader, "СТАТУС_КАРТОЧКА"));
			element.SetData("НОМЕР_НАРЯД_КАРТОЧКА", DbSql.GetValueLong(reader, "НОМЕР_НАРЯД_КАРТОЧКА"));
			element.SetData("ДАТА", DbSql.GetValueDate(reader, "ДАТА"));
			element.SetData("ДАТА_НАРЯД_ОТКРЫТ_КАРТОЧКА", DbSql.GetValueDate(reader, "ДАТА_НАРЯД_ОТКРЫТ_КАРТОЧКА"));
			element.SetData("ДАТА_НАРЯД_ЗАКРЫТ_КАРТОЧКА", DbSql.GetValueDate(reader, "ДАТА_НАРЯД_ЗАКРЫТ_КАРТОЧКА"));
			element.SetData("ПОДРАЗДЕЛЕНИЕ_КАРТОЧКА", DbSql.GetValueLong(reader, "ПОДРАЗДЕЛЕНИЕ_КАРТОЧКА"));
			element.SetData("ВИД_ГАРАНТИЯ_КАРТОЧКА", DbSql.GetValueLong(reader, "ВИД_ГАРАНТИЯ_КАРТОЧКА"));
			element.SetData("ВИД_ТРУДОЕМКОСТЬ_КАРТОЧКА", DbSql.GetValueLong(reader, "ВИД_ТРУДОЕМКОСТЬ_КАРТОЧКА"));
			element.SetData("БЕЗНАЛИЧНЫЙ_КАРТОЧКА", DbSql.GetValueBool(reader, "БЕЗНАЛИЧНЫЙ_КАРТОЧКА"));
			element.SetData("ВНУТРЕННИЙ_КАРТОЧКА", DbSql.GetValueBool(reader, "ВНУТРЕННИЙ_КАРТОЧКА"));
			element.SetData("МАСТЕР_КОНТРОЛЕР_КАРТОЧКА", DbSql.GetValueLong(reader, "МАСТЕР_КОНТРОЛЕР_КАРТОЧКА"));
			element.SetData("ПРИМЕЧАНИЕ_КАРТОЧКА", DbSql.GetValueString(reader, "ПРИМЕЧАНИЕ_КАРТОЧКА"));
			element.SetData("СКИДКА_РАБОТА_КАРТОЧКА", DbSql.GetValueFloat(reader, "СКИДКА_РАБОТА_КАРТОЧКА"));
            element.SetData("СКИДКА_ДЕТАЛЬ_КАРТОЧКА", DbSql.GetValueFloat(reader, "СКИДКА_ДЕТАЛЬ_КАРТОЧКА"));
			element.SetData("ОДОБРЕНИЕ_ГАРАНТИЯ", DbSql.GetValueLong(reader, "ОДОБРЕНИЕ_ГАРАНТИЯ"));
			element.SetData("ОДОБРЕНИЕ_ОПЛАТА", DbSql.GetValueLong(reader, "ОДОБРЕНИЕ_ОПЛАТА"));
			element.SetData("ОДОБРЕНИЕ_ПОЛНОЕ", DbSql.GetValueLong(reader, "ОДОБРЕНИЕ_ПОЛНОЕ"));
			element.SetData("СВИДЕТЕЛЬСТВО_ТС", DbSql.GetValueLong(reader, "СВИДЕТЕЛЬСТВО_ТС"));
			element.SetData("ЗАКРЫЛ_НАРЯД", DbSql.GetValueString(reader, "ЗАКРЫЛ_НАРЯД"));
			element.SetData("ВОЗВРАТ", DbSql.GetValueBool(reader, "ВОЗВРАТ"));
			element.SetData("СЕРВИС_КОНСУЛЬТАНТ", DbSql.GetValueLong(reader, "СЕРВИС_КОНСУЛЬТАНТ"));
			element.SetData("КРЕДИТНАЯ_КАРТА_КАРТОЧКА", DbSql.GetValueBool(reader, "КРЕДИТНАЯ_КАРТА_КАРТОЧКА"));
			//	element.SetData("ВЛАДЕЛЕЦ", DbSql.GetValueString(reader, "ВЛАДЕЛЕЦ"));
			//	element.SetData("АВТОМОБИЛЬ_МОДЕЛЬ", DbSql.GetValueString(reader, "АВТОМОБИЛЬ_МОДЕЛЬ"));
			//	element.SetData("АВТОМОБИЛЬ_VIN", DbSql.GetValueString(reader, "АВТОМОБИЛЬ_VIN"));
			//	element.SetData("АВТОМОБИЛЬ_РЕГИСТРАЦИОННЫЙ_ЗНАК", DbSql.GetValueString(reader, "АВТОМОБИЛЬ_РЕГИСТРАЦИОННЫЙ_ЗНАК"));
			if (DbSql.IsValueNULL(reader, "ВРЕМЯ_ВЫДАЧИ_СОГЛАСОВАННОЕ") == false)
            {
				element.SetData("ВРЕМЯ_ВЫДАЧИ_СОГЛАСОВАННОЕ", DbSql.GetValueDate(reader, "ВРЕМЯ_ВЫДАЧИ_СОГЛАСОВАННОЕ"));
				element.SetData("ЕСТЬ_ВРЕМЯ_ВЫДАЧИ_СОГЛАСОВАННОЕ", true);
			}		
			return (object)(DtCard)element;
		}

		public static object MakeElementСardRate(SqlDataReader reader)
		{
			DtCard element = new DtCard();
			element.SetData("КОД_КАРТОЧКА", DbSql.GetValueLong(reader, "КОД_КАРТОЧКА"));
			element.SetData("НОМЕР_КАРТОЧКА", DbSql.GetValueLong(reader, "НОМЕР_КАРТОЧКА"));
			element.SetData("ГОД_КАРТОЧКА", DbSql.GetValueInt(reader, "ГОД_КАРТОЧКА"));
			element.SetData("ВЛАДЕЛЕЦ_КАРТОЧКА", DbSql.GetValueLong(reader, "ВЛАДЕЛЕЦ_КАРТОЧКА"));
			element.SetData("ВЛАДЕЛЕЦ_КАРТОЧКА", DbSql.GetValueLong(reader, "ВЛАДЕЛЕЦ_КАРТОЧКА"));
			element.SetData("ПРЕДСТАВИТЕЛЬ_КАРТОЧКА", DbSql.GetValueLong(reader, "ПРЕДСТАВИТЕЛЬ_КАРТОЧКА"));
			element.CodeAuto = DbSql.GetValueLong(reader, "АВТОМОБИЛЬ_КАРТОЧКА");
			element.SetData("ДОКУМЕНТ_ПРЕДСТАВИТЕЛЬ_КАРТОЧКА", DbSql.GetValueString(reader, "ДОКУМЕНТ_ПРЕДСТАВИТЕЛЬ_КАРТОЧКА"));
			element.SetData("ПРОБЕГ_КАРТОЧКА", DbSql.GetValueInt(reader, "ПРОБЕГ_КАРТОЧКА"));
					element.SetData("СТАТУС_КАРТОЧКА", DbSql.GetValueShort(reader, "СТАТУС_КАРТОЧКА"));
			element.SetData("НОМЕР_НАРЯД_КАРТОЧКА", DbSql.GetValueLong(reader, "НОМЕР_НАРЯД_КАРТОЧКА"));
			element.SetData("ДАТА", DbSql.GetValueDate(reader, "ДАТА"));
			element.SetData("ДАТА_НАРЯД_ОТКРЫТ_КАРТОЧКА", DbSql.GetValueDate(reader, "ДАТА_НАРЯД_ОТКРЫТ_КАРТОЧКА"));
			element.SetData("ДАТА_НАРЯД_ЗАКРЫТ_КАРТОЧКА", DbSql.GetValueDate(reader, "ДАТА_НАРЯД_ЗАКРЫТ_КАРТОЧКА"));
			element.SetData("ПОДРАЗДЕЛЕНИЕ_КАРТОЧКА", DbSql.GetValueLong(reader, "ПОДРАЗДЕЛЕНИЕ_КАРТОЧКА"));
			element.SetData("ВИД_ГАРАНТИЯ_КАРТОЧКА", DbSql.GetValueLong(reader, "ВИД_ГАРАНТИЯ_КАРТОЧКА"));
			element.SetData("ВИД_ТРУДОЕМКОСТЬ_КАРТОЧКА", DbSql.GetValueLong(reader, "ВИД_ТРУДОЕМКОСТЬ_КАРТОЧКА"));
			element.SetData("БЕЗНАЛИЧНЫЙ_КАРТОЧКА", DbSql.GetValueBool(reader, "БЕЗНАЛИЧНЫЙ_КАРТОЧКА"));
			element.SetData("ВНУТРЕННИЙ_КАРТОЧКА", DbSql.GetValueBool(reader, "ВНУТРЕННИЙ_КАРТОЧКА"));
			element.SetData("МАСТЕР_КОНТРОЛЕР_КАРТОЧКА", DbSql.GetValueLong(reader, "МАСТЕР_КОНТРОЛЕР_КАРТОЧКА"));
			element.SetData("ПРИМЕЧАНИЕ_КАРТОЧКА", DbSql.GetValueString(reader, "ПРИМЕЧАНИЕ_КАРТОЧКА"));
			element.SetData("СКИДКА_РАБОТА_КАРТОЧКА", DbSql.GetValueFloat(reader, "СКИДКА_РАБОТА_КАРТОЧКА"));
            element.SetData("СКИДКА_ДЕТАЛЬ_КАРТОЧКА", DbSql.GetValueFloat(reader, "СКИДКА_ДЕТАЛЬ_КАРТОЧКА"));
			element.SetData("ОДОБРЕНИЕ_ГАРАНТИЯ", DbSql.GetValueLong(reader, "ОДОБРЕНИЕ_ГАРАНТИЯ"));
			element.SetData("ОДОБРЕНИЕ_ОПЛАТА", DbSql.GetValueLong(reader, "ОДОБРЕНИЕ_ОПЛАТА"));
			element.SetData("ОДОБРЕНИЕ_ПОЛНОЕ", DbSql.GetValueLong(reader, "ОДОБРЕНИЕ_ПОЛНОЕ"));
			element.SetData("СВИДЕТЕЛЬСТВО_ТС", DbSql.GetValueLong(reader, "СВИДЕТЕЛЬСТВО_ТС"));
			element.SetData("ЗАКРЫЛ_НАРЯД", DbSql.GetValueString(reader, "ЗАКРЫЛ_НАРЯД"));
			element.SetData("ВОЗВРАТ", DbSql.GetValueBool(reader, "ВОЗВРАТ"));
			element.SetData("СЕРВИС_КОНСУЛЬТАНТ", DbSql.GetValueLong(reader, "СЕРВИС_КОНСУЛЬТАНТ"));
			element.SetData("КАРТОЧКА_ОЦЕНКА", DbSql.GetValueShort(reader, "КАРТОЧКА_ОЦЕНКА"));
			element.SetData("ВЛАДЕЛЕЦ", DbSql.GetValueString(reader, "ВЛАДЕЛЕЦ"));
			element.SetData("АВТОМОБИЛЬ_МОДЕЛЬ", DbSql.GetValueString(reader, "АВТОМОБИЛЬ_МОДЕЛЬ"));
			element.SetData("АВТОМОБИЛЬ_VIN", DbSql.GetValueString(reader, "АВТОМОБИЛЬ_VIN"));
			element.SetData("АВТОМОБИЛЬ_РЕГИСТРАЦИОННЫЙ_ЗНАК", DbSql.GetValueString(reader, "АВТОМОБИЛЬ_РЕГИСТРАЦИОННЫЙ_ЗНАК"));
			element.SetData("СЕРВИС_КОНСУЛЬТАНТ_ФАМИЛИЯ", DbSql.GetValueString(reader, "СЕРВИС_КОНСУЛЬТАНТ_ФАМИЛИЯ"));
			element.SetData("РЕКОМЕНДАЦИЯ", DbSql.GetValueShort(reader, "РЕКОМЕНДАЦИЯ"));
			element.SetData("РЕКОМЕНДАЦИЯ_ИЗМЕНЕНА", DbSql.GetValueBool(reader, "РЕКОМЕНДАЦИЯ_ИЗМЕНЕНА"));
			element.SetData("ОБЩАЯ_ОЦЕНКА", DbSql.GetValueShort(reader, "ОБЩАЯ_ОЦЕНКА"));
			element.SetData("НЕИСПРАВНОСТЬ_УСТРАНЕНА", DbSql.GetValueBool(reader, "НЕИСПРАВНОСТЬ_УСТРАНЕНА"));
			
			return (object)(DtCard)element;
		}

		public static ListViewItem MakeLV_List(SqlDataReader reader)
		{
			ListViewItem item = new ListViewItem();
			item.Tag			= DbSql.GetValueLong(reader, "КОД_КАРТОЧКА");
			item.Text			= DbSql.GetValueLongTxt(reader, "НОМЕР_КАРТОЧКА");
			item.SubItems.Add(DbSql.GetValueDateTxt(reader, "ДАТА"));
			item.SubItems.Add(DbSql.GetValueLongTxt(reader, "НОМЕР_НАРЯД"));
			item.SubItems.Add(DbSql.GetValueString(reader, "ВЛАДЕЛЕЦ"));
			item.SubItems.Add(DbSql.GetValueString(reader, "АВТОМОБИЛЬ_МОДЕЛЬ"));
			item.SubItems.Add(DbSql.GetValueString(reader, "АВТОМОБИЛЬ_VIN"));
			item.SubItems.Add(DbSql.GetValueString(reader, "АВТОМОБИЛЬ_РЕГИСТРАЦИОННЫЙ_ЗНАК"));
			item.SubItems.Add(DbSql.GetValueInt(reader, "ПРОБЕГ_КАРТОЧКА").ToString());
			item.SubItems.Add(DbSql.GetValueString(reader, "СЕРВИС_КОНСУЛЬТАНТ_ФАМИЛИЯ") + "/" + DbSql.GetValueString(reader, "ЗАКРЫЛ_НАРЯД"));
			item.SubItems.Add(DbSql.GetValueString(reader, "ПРИМЕЧАНИЕ_КАРТОЧКА"));
			switch(DbSql.GetValueSmallInt(reader, "СТАТУС_КАРТОЧКА"))
			{
				case 1:
					item.BackColor = Color.Yellow;
					break;
				case 2:
					item.BackColor = Color.LightGreen;
					break;
				case 3:
					item.BackColor = Color.Red;
					break;
				case 4:
					item.BackColor = Color.Yellow;
					break;
				case 5:
					item.BackColor = Color.Gray;
					break;
				default:
					break;
			}
			// Обработка наличного/безналичного расчета
			switch(DbSql.GetValueShort(reader, "СТАТУС_КОНТРОЛЬ_КАРТОЧКА"))
			{
				case 0:
					item.StateImageIndex = 0;
					break;
				case 1:
					item.StateImageIndex = 1;
					break;
				case 2:
					item.StateImageIndex = 2;
					break;
				default:
					item.StateImageIndex = 0;
					break;
			}
			return item;
		}

		

		public static DtCard Find(long code)
		{
			// Подготовка команды поиска по маске
			find.Parameters["@code"].Value = (long)code;
			DtCard element = (DtCard)DbSql.Find(find, new DbSql.DelegateMakeElement(MakeElement));
			return element;
		}
		public static DtCard Find(long number, int year)
		{
			// Подготовка команды поиска по маске
			find_number_year.Parameters["@number"].Value = (long)number;
			find_number_year.Parameters["@year"].Value = (int)year;
			DtCard element = (DtCard)DbSql.Find(find_number_year, new DbSql.DelegateMakeElement(MakeElement));
			return element;
		}

		public static DtCard FindRate(long number, int year)
		{
			// Подготовка команды поиска по маске
			find_rate.Parameters["@number"].Value	= (long)number;
			find_rate.Parameters["@year"].Value		= (int)year;
			DtCard element = (DtCard)DbSql.Find(find_rate, new DbSql.DelegateMakeElement(MakeElementСardRate));
			return element;
		}

		public static object MakeElementList(SqlDataReader reader)
		{
			DtCard element = new DtCard();
			element.SetData("КОД_КАРТОЧКА", DbSql.GetValueLong(reader, "КОД_КАРТОЧКА"));
			element.SetData("НОМЕР_КАРТОЧКА", DbSql.GetValueLong(reader, "НОМЕР_КАРТОЧКА"));
			element.SetData("СТАТУС_КАРТОЧКА", DbSql.GetValueShort(reader, "СТАТУС_КАРТОЧКА"));
			element.SetData("НОМЕР_НАРЯД_КАРТОЧКА", DbSql.GetValueLong(reader, "НОМЕР_НАРЯД"));
			element.SetData("ДАТА", DbSql.GetValueDate(reader, "ДАТА"));
			element.SetData("СТАТУС_КОНТРОЛЬ_КАРТОЧКА", DbSql.GetValueShort(reader, "СТАТУС_КОНТРОЛЬ_КАРТОЧКА"));
			element.SetData("ПРИМЕЧАНИЕ_КАРТОЧКА", DbSql.GetValueString(reader, "ПРИМЕЧАНИЕ_КАРТОЧКА"));
			element.SetData("ВЛАДЕЛЕЦ", DbSql.GetValueString(reader, "ВЛАДЕЛЕЦ"));
			element.SetData("АВТОМОБИЛЬ_МОДЕЛЬ", DbSql.GetValueString(reader, "АВТОМОБИЛЬ_МОДЕЛЬ"));
			element.SetData("АВТОМОБИЛЬ_VIN", DbSql.GetValueString(reader, "АВТОМОБИЛЬ_VIN"));
			element.SetData("АВТОМОБИЛЬ_РЕГИСТРАЦИОННЫЙ_ЗНАК", DbSql.GetValueString(reader, "АВТОМОБИЛЬ_РЕГИСТРАЦИОННЫЙ_ЗНАК"));
			element.SetData("ПРОБЕГ_КАРТОЧКА", DbSql.GetValueInt(reader, "ПРОБЕГ_КАРТОЧКА"));
			element.SetData("ЗАКРЫЛ_НАРЯД", DbSql.GetValueString(reader, "ЗАКРЫЛ_НАРЯД"));
			element.SetData("СЕРВИС_КОНСУЛЬТАНТ_ФАМИЛИЯ", DbSql.GetValueString(reader, "СЕРВИС_КОНСУЛЬТАНТ_ФАМИЛИЯ"));
			return (object)(DtCard)element;
		}

		public static object MakeElementList2(SqlDataReader reader)
		{
			DtCard element = new DtCard();
			element.SetData("КОД_КАРТОЧКА", DbSql.GetValueLong(reader, "КОД_КАРТОЧКА"));
			element.SetData("НОМЕР_КАРТОЧКА", DbSql.GetValueLong(reader, "НОМЕР_КАРТОЧКА"));
			element.SetData("ГОД_КАРТОЧКА", DbSql.GetValueInt(reader, "ГОД_КАРТОЧКА"));
			element.SetData("СТАТУС_КАРТОЧКА", DbSql.GetValueShort(reader, "СТАТУС_КАРТОЧКА"));
			element.SetData("НОМЕР_НАРЯД_КАРТОЧКА", DbSql.GetValueLong(reader, "НОМЕР_НАРЯД"));
			element.SetData("ДАТА", DbSql.GetValueDate(reader, "ДАТА"));
			element.SetData("СТАТУС_КОНТРОЛЬ_КАРТОЧКА", DbSql.GetValueShort(reader, "СТАТУС_КОНТРОЛЬ_КАРТОЧКА"));
			element.SetData("ПРИМЕЧАНИЕ_КАРТОЧКА", DbSql.GetValueString(reader, "ПРИМЕЧАНИЕ_КАРТОЧКА"));
			element.SetData("ВЛАДЕЛЕЦ", DbSql.GetValueString(reader, "ВЛАДЕЛЕЦ"));
			element.SetData("АВТОМОБИЛЬ_МОДЕЛЬ", DbSql.GetValueString(reader, "АВТОМОБИЛЬ_МОДЕЛЬ"));
			element.SetData("АВТОМОБИЛЬ_VIN", DbSql.GetValueString(reader, "АВТОМОБИЛЬ_VIN"));
			element.SetData("АВТОМОБИЛЬ_РЕГИСТРАЦИОННЫЙ_ЗНАК", DbSql.GetValueString(reader, "АВТОМОБИЛЬ_РЕГИСТРАЦИОННЫЙ_ЗНАК"));
			element.SetData("ПРОБЕГ_КАРТОЧКА", DbSql.GetValueInt(reader, "ПРОБЕГ_КАРТОЧКА"));
			element.SetData("ЗАКРЫЛ_НАРЯД", DbSql.GetValueString(reader, "ЗАКРЫЛ_НАРЯД"));
			return (object)(DtCard)element;
		}

		public static DtCard FindList(DbCard card)
		{
			// Подготовка команды поиска по маске
			select_number_year.Parameters["@number"].Value = (long)card.Number;
			select_number_year.Parameters["@year"].Value = (int)card.Year;
			DtCard element = (DtCard)DbSql.Find(select_number_year, new DbSql.DelegateMakeElement(MakeElementList));
			return element;
		}

		public static DtCard FindList(DtCard card)
		{
			// Подготовка команды поиска по маске
			select_number_year.Parameters["@number"].Value = (long)card.GetData("НОМЕР_КАРТОЧКА");
			select_number_year.Parameters["@year"].Value = (int)card.GetData("ГОД_КАРТОЧКА");
			DtCard element = (DtCard)DbSql.Find(select_number_year, new DbSql.DelegateMakeElement(MakeElementList));
			return element;
		}


		public static bool SetStatusControl(long code, short status_control)
		{
			// Изменение контрольного статуса карточки
			set_status_control.Parameters["@code"].Value = (long)code;
			set_status_control.Parameters["@status_control"].Value = (short)status_control;
			return DbSql.ExecuteCommandError(set_status_control);
		}

		public static bool SetMaster(DbCard card, DbStaff master)
		{
			// Изменение контрольного статуса карточки
			set_master.Parameters["@card_number"].Value = (long)card.Number;
			set_master.Parameters["@card_year"].Value = (int)card.Year;
			set_master.Parameters["@card_code"].Value = (long)0;
			set_master.Parameters["@master_code"].Value = (long)master.Code;
			return DbSql.ExecuteCommandError(set_master);
		}

		public static bool SetLicenceVehicle(DbCard card, long code)
		{
			// Изменение контрольного статуса карточки
			set_licence_vehicle.Parameters["@card_number"].Value	= (long)card.Number;
			set_licence_vehicle.Parameters["@card_year"].Value		= (int)card.Year;
			set_licence_vehicle.Parameters["@code_licence"].Value	= (long)code;
			return DbSql.ExecuteCommandError(set_licence_vehicle);
		}

		public static bool SetLicencePlate(DbCard card, string plate_number, string plate_region)
		{
			// Изменение контрольного статуса карточки
			set_licence_plate.Parameters["@card_number"].Value			= (long)card.Number;
			set_licence_plate.Parameters["@card_year"].Value			= (int)card.Year;
			set_licence_plate.Parameters["@licence_plate_number"].Value	= (string)plate_number;
			set_licence_plate.Parameters["@licence_plate_region"].Value	= (string)plate_region;
			return DbSql.ExecuteCommandError(set_licence_plate);
		}

		public static bool SetReturnFlag(DbCard card, bool return_flag)
		{
			// Изменение контрольного статуса карточки
			set_return_flag.Parameters["@card_number"].Value			= (long)card.Number;
			set_return_flag.Parameters["@card_year"].Value			= (int)card.Year;
			set_return_flag.Parameters["@returned"].Value				= (bool)return_flag;
			return DbSql.ExecuteCommandError(set_return_flag);
		}

		public static bool SetMaster(DbCard card, DtStaff master)
		{
			// Изменение контрольного статуса карточки
			set_master.Parameters["@card_number"].Value = (long)card.Number;
			set_master.Parameters["@card_year"].Value = (int)card.Year;
			set_master.Parameters["@card_code"].Value = (long)0;
			set_master.Parameters["@master_code"].Value = (long)master.GetData("КОД_ПЕРСОНАЛ");
			return DbSql.ExecuteCommandError(set_master);
		}

		public static bool SetMaster(long card_number, int card_year, DtStaff master)
		{
			// Изменение контрольного статуса карточки
			set_master.Parameters["@card_number"].Value = (long)card_number;
			set_master.Parameters["@card_year"].Value = (int)card_year;
			set_master.Parameters["@card_code"].Value = (long)0;
			set_master.Parameters["@master_code"].Value = (long)master.GetData("КОД_ПЕРСОНАЛ");
			return DbSql.ExecuteCommandError(set_master);
		}

		public static bool SetSupervisorGuaranty(long card_number, int card_year, long supervisor_guaranty)
		{
			// Изменение контрольного статуса карточки
			set_supervisor_guaranty.Parameters["@card_number"].Value		= (long)card_number;
			set_supervisor_guaranty.Parameters["@card_year"].Value			= (int)card_year;
			set_supervisor_guaranty.Parameters["@supervisor_guaranty"].Value= (long)supervisor_guaranty;
			return DbSql.ExecuteCommandError(set_supervisor_guaranty);
		}

		public static bool SetSupervisorWhole(long card_number, int card_year, long supervisor_whole)
		{
			// Изменение контрольного статуса карточки
			set_supervisor_whole.Parameters["@card_number"].Value		= (long)card_number;
			set_supervisor_whole.Parameters["@card_year"].Value			= (int)card_year;
			set_supervisor_whole.Parameters["@supervisor_whole"].Value	= (long)supervisor_whole;
			return DbSql.ExecuteCommandError(set_supervisor_whole);
		}

		public static bool SetSupervisorPayment(long card_number, int card_year, long supervisor_payment)
		{
			// Изменение контрольного статуса карточки
			set_supervisor_payment.Parameters["@card_number"].Value		= (long)card_number;
			set_supervisor_payment.Parameters["@card_year"].Value			= (int)card_year;
			set_supervisor_payment.Parameters["@supervisor_payment"].Value= (long)supervisor_payment;
			return DbSql.ExecuteCommandError(set_supervisor_payment);
		}

		public static bool SetDiscount(DbCard card, float discount, long code_discount)
		{
			// Изменение контрольного статуса карточки
			set_discount.Parameters["@card_number"].Value	= (long)card.Number;
			set_discount.Parameters["@card_year"].Value		= (int)card.Year;
			set_discount.Parameters["@card_code"].Value		= (long)0;
			set_discount.Parameters["@code_discount"].Value	= (long)code_discount;
			set_discount.Parameters["@discount"].Value		= (float)discount;
			return DbSql.ExecuteCommandError(set_discount);
		}

        public static bool SetDiscountParts(DbCard card, float discount)
        {
            // Изменение контрольного статуса карточки
            set_discount_parts.Parameters["@card_number"].Value = (long)card.Number;
            set_discount_parts.Parameters["@card_year"].Value = (int)card.Year;
            set_discount_parts.Parameters["@discount"].Value = (float)discount;
            return DbSql.ExecuteCommandError(set_discount_parts);
        }

		public static bool SetDiscount(long card_number, int card_year, float discount, long code_discount)
		{
			// Изменение контрольного статуса карточки
			set_discount.Parameters["@card_number"].Value	= (long)card_number;
			set_discount.Parameters["@card_year"].Value		= (int)card_year;
			set_discount.Parameters["@card_code"].Value		= (long)0;
			set_discount.Parameters["@code_discount"].Value	= (long)code_discount;
			set_discount.Parameters["@discount"].Value		= (float)discount;
			return DbSql.ExecuteCommandError(set_discount);
		}

		public static bool SetPrint(long card_number, int card_year)
		{
			// Изменение контрольного статуса карточки
			set_print.Parameters["@card_number"].Value	= (long)card_number;
			set_print.Parameters["@card_year"].Value	= (int)card_year;
			return DbSql.ExecuteCommandError(set_print);
		}

		public static bool SetServiceManager(DtCard card, DtStaff service_manager)
		{
			// Изменение контрольного статуса карточки
			set_service_manager.Parameters["@card_number"].Value = (long)card.GetData("НОМЕР_КАРТОЧКА");
			set_service_manager.Parameters["@card_year"].Value = (int)card.GetData("ГОД_КАРТОЧКА");
			set_service_manager.Parameters["@service_manager_code"].Value = (long)service_manager.GetData("КОД_ПЕРСОНАЛ");
			return DbSql.ExecuteCommandError(set_service_manager);
		}
		public static bool SetServiceManagerEver(DtCard card, DtStaff service_manager)
		{
			// Изменение контрольного статуса карточки
			set_service_manager_ever.Parameters["@card_number"].Value = (long)card.GetData("НОМЕР_КАРТОЧКА");
			set_service_manager_ever.Parameters["@card_year"].Value = (int)card.GetData("ГОД_КАРТОЧКА");
			set_service_manager_ever.Parameters["@service_manager_code"].Value = (long)service_manager.GetData("КОД_ПЕРСОНАЛ");
			return DbSql.ExecuteCommandError(set_service_manager_ever);
		}

		public static bool SetCreditcardFlag(DbCard card, bool creditcard_flag)
		{
			// Изменение контрольного статуса карточки
			set_creditcard_flag.Parameters["@card_number"].Value		= (long)card.Number;
			set_creditcard_flag.Parameters["@card_year"].Value			= (int)card.Year;
			set_creditcard_flag.Parameters["@creditcard"].Value			= (bool)creditcard_flag;
			return DbSql.ExecuteCommandError(set_creditcard_flag);
		}

		public static bool CardSetAgreedPickupTime(long card_number, int card_year, DateTime pickupTime)
		{
			// Изменение контрольного статуса карточки
			card_set_agreedPickupTime.Parameters["@number"].Value = (long)card_number;
			card_set_agreedPickupTime.Parameters["@year"].Value = (int)card_year;
			card_set_agreedPickupTime.Parameters["@date"].Value = (DateTime)pickupTime;
			return DbSql.ExecuteCommandError(card_set_agreedPickupTime);
		}

		#region Опасные служебные
		public static bool AuxiliaryAutoSetNull(long card_number, int card_year)
		{
			// Изменение контрольного статуса карточки
			auxiliary_auto_set_null.Parameters["@card_number"].Value	= (long)card_number;
			auxiliary_auto_set_null.Parameters["@card_year"].Value		= (int)card_year;
			return DbSql.ExecuteCommandError(auxiliary_auto_set_null);
		}
		public static bool AuxiliaryAutoSetNull(DtCard card)
		{
			// Изменение контрольного статуса карточки
			auxiliary_auto_set_null.Parameters["@card_number"].Value	= (long)card.GetData("НОМЕР_КАРТОЧКА");
			auxiliary_auto_set_null.Parameters["@card_year"].Value		= (int)card.GetData("ГОД_КАРТОЧКА");
			return DbSql.ExecuteCommandError(auxiliary_auto_set_null);
		}
		public static bool AuxiliaryPartnerReplace(DtCard card, DbPartner partner)
		{
			// Изменение контрольного статуса карточки
			auxiliary_partner_replace.Parameters["@card_number"].Value	= (long)card.GetData("НОМЕР_КАРТОЧКА");
			auxiliary_partner_replace.Parameters["@card_year"].Value	= (int)card.GetData("ГОД_КАРТОЧКА");
			auxiliary_partner_replace.Parameters["@code_partner"].Value	= (long)partner.Code;
			return DbSql.ExecuteCommandError(auxiliary_partner_replace);
		}
		public static bool AuxiliaryAutoReplace(DtCard card, DtAuto auto)
		{
			// Изменение контрольного статуса карточки
			auxiliary_auto_replace.Parameters["@card_number"].Value	= (long)card.GetData("НОМЕР_КАРТОЧКА");
			auxiliary_auto_replace.Parameters["@card_year"].Value	= (int)card.GetData("ГОД_КАРТОЧКА");
			auxiliary_auto_replace.Parameters["@code_auto"].Value	= (long)auto.GetData("КОД_АВТОМОБИЛЬ");
			return DbSql.ExecuteCommandError(auxiliary_auto_replace);
		}
		public static bool AuxiliaryCardInsert(long card_number, DateTime card_date)
		{
			// Изменение контрольного статуса карточки
			auxiliary_card_insert.Parameters["@number"].Value	= (long)card_number;
			auxiliary_card_insert.Parameters["@date"].Value	= (DateTime)card_date;
			return DbSql.ExecuteCommandError(auxiliary_card_insert);
		}

		public static bool AuxiliaryCardSetDate(long card_number, int card_year, DateTime card_date)
		{
			// Изменение контрольного статуса карточки
			auxiliary_card_set_date.Parameters["@number"].Value	= (long)card_number;
			auxiliary_card_set_date.Parameters["@year"].Value	= (int)card_year;
			auxiliary_card_set_date.Parameters["@date"].Value	= (DateTime)card_date;
			return DbSql.ExecuteCommandError(auxiliary_card_set_date);
		}
		public static bool AuxiliaryWarrantSet(long card_number, int card_year, long warrant_number, DateTime warrant_date)
		{
			// Изменение контрольного статуса карточки
			auxiliary_warrant_set.Parameters["@number"].Value			= (long)card_number;
			auxiliary_warrant_set.Parameters["@year"].Value				= (int)card_year;
			auxiliary_warrant_set.Parameters["@warrant_date"].Value		= (DateTime)warrant_date;
			auxiliary_warrant_set.Parameters["@warrant_number"].Value	= (long)warrant_number;
			return DbSql.ExecuteCommandError(auxiliary_warrant_set);
		}
		public static bool AuxiliaryWarrantOpen(long card_number, int card_year, long warrant_number, DateTime warrant_date)
		{
			// Изменение контрольного статуса карточки
			auxiliary_warrant_open.Parameters["@number"].Value			= (long)card_number;
			auxiliary_warrant_open.Parameters["@year"].Value			= (int)card_year;
			auxiliary_warrant_open.Parameters["@warrant_date"].Value	= (DateTime)warrant_date;
			auxiliary_warrant_open.Parameters["@warrant_number"].Value	= (long)warrant_number;
			return DbSql.ExecuteCommandError(auxiliary_warrant_open);
		}
		public static bool AuxiliaryRunSet(long card_number, int card_year, int run)
		{
			// Изменение контрольного статуса карточки
			auxiliary_run_set.Parameters["@number"].Value			= (long)card_number;
			auxiliary_run_set.Parameters["@year"].Value				= (int)card_year;
			auxiliary_run_set.Parameters["@run"].Value		= (int)run;
			return DbSql.ExecuteCommandError(auxiliary_run_set);
		}
		public static bool AuxiliaryWarrantClose(long card_number, int card_year, DateTime close_date)
		{
			// Изменение контрольного статуса карточки
			auxiliary_warrant_close.Parameters["@number"].Value			= (long)card_number;
			auxiliary_warrant_close.Parameters["@year"].Value			= (int)card_year;
			auxiliary_warrant_close.Parameters["@close_date"].Value		= (DateTime)close_date;
			return DbSql.ExecuteCommandError(auxiliary_warrant_close);
		}
		public static bool AuxiliaryWarrantCloseSet(long card_number, int card_year, DateTime close_date)
		{
			// Изменение контрольного статуса карточки
			auxiliary_warrant_close_set.Parameters["@number"].Value			= (long)card_number;
			auxiliary_warrant_close_set.Parameters["@year"].Value			= (int)card_year;
			auxiliary_warrant_close_set.Parameters["@close_date"].Value		= (DateTime)close_date;
			return DbSql.ExecuteCommandError(auxiliary_warrant_close_set);
		}
		#endregion
	}

	// Структура для поиска в базе
	public class SearchCard
	{
		private DateTime	date_start;
		private DateTime	date_end;
		private bool		no_date;
		private bool		show_cancel;
		private string		owner_mask;
		private string		vin_mask;
		private string		sign_mask;
		private long		code_workshop;


		public SearchCard()
		{
			ClearTemp();
		}
		public void ClearTemp()
		{
			owner_mask = "";
			vin_mask = "";
			sign_mask = "";
		}
		public void SetDates(DateTime start, DateTime end)
		{
			date_start = start;
			date_end = end;
		}
		public void SetNoDate(bool data)
		{
			no_date = data;
		}
		public void SetShowCancel(bool data)
		{
			show_cancel = data;
		}
		public void SetOwnerMask(string data)
		{
			owner_mask = data;
		}
		public void SetVinMask(string data)
		{
			vin_mask = data;
		}
		public void SetSignMask(string data)
		{
			sign_mask = data;
		}
		public void SetWorkshop(long data)
		{
			code_workshop = data;
		}

		public DateTime DateStart
		{
			get{ return date_start; }
		}
		public DateTime DateEnd
		{
			get{ return date_end; }
		}
		public bool NoDate
		{
			get{ return no_date; }
		}
		public bool ShowCancel
		{
			get{ return show_cancel; }
		}
		public string OwnerMask
		{
			get{ return owner_mask; }
		}
		public string VinMask
		{
			get{ return vin_mask; }
		}
		public string SignMask
		{
			get{ return sign_mask; }
		}
		public long Workshop
		{
			get{ return code_workshop; }
		}
	}
}
